<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Boids</title>

        <!-- vertex shader -->
        <script id="vertex-shader" type="x-shader/x-vertex">
            #version 300 es

            // input position attribute
            in vec4 vecPosition;
            in vec4 vecNormal;

            // transformation matrices
            uniform mat4 modelView;
            uniform mat4 projection;

            uniform vec4 lightPosition;

            // varying
            // out?
            out vec3 N;
            out vec3 L;
            out vec3 E;

            void main() {
                vec3 position = (modelView * vecPosition).xyz;
                L = normalize(lightPosition.xyz - position);
                // camera is at origin
                E = normalize(-position);
                // transform normal
                N = normalize((modelView * vecNormal).xyz);

                gl_Position = projection * modelView * vecPosition;
            }
        </script>

        <!-- fragment shader -->
        <!-- type="x-shader/x-vertex" -->
        <script id="fragment-shader" type="x-shader/x-fragment">
            #version 300 es

            precision mediump float;

            uniform vec4 ambientProduct;
            uniform vec4 diffuseProduct;
            uniform vec4 specularProduct;
            // uniform vec4 lightPosition;

            uniform float shininess;

            // varying
            in vec3 N;
            in vec3 L;
            in vec3 E;

            out vec4 fragColor;

            void main() {
                vec4 ambient = ambientProduct;

                float Kd = max(dot(L, N), 0.0);
                vec4 diffuse = Kd * diffuseProduct;

                vec3 H = normalize(L + E);
                float Ks = pow(max(dot(N, H), 0.0), shininess);
                // vec4 specular = dot(L, N) < 0.0 ? vec4(0, 0, 0, 1) : Ks * specularProduct;
                vec4 specular = Ks * specularProduct;
                // light source is not visible
                if (dot(L, N) < 0.0) {
                    specular = vec4(0, 0, 0, 1);
                }

                fragColor = ambient + diffuse + specular;
                fragColor.a = 1.0;
                // gl_FragColor = fragColor;
            }
        </script>

        <script defer src="./common/init-shaders.js"></script>
        <script defer src="./common/utils.js"></script>
        <script defer src="./common/flatten.js"></script>
        <script defer src="./common/mat-vec.js"></script>
        <script defer src="./common/transform.js"></script>
        <script defer src="./common/projection.js"></script>
        <script defer src="./common/create-teapot-data.js"></script>
        <script defer src="./common/patches.js"></script>
        <script defer src="./common/vertices.js"></script>
        <script defer src="./teapot.js"></script>
    </head>

    <body>
        <canvas id="webgl-canvas" width="512" height="512"
            >Your browser does not support the HTML5 canvas element.</canvas
        >
    </body>
</html>
